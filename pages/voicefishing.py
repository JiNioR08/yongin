import re                               # ì •ê·œì‹(regular expression) ì‚¬ìš©: ì»¬ëŸ¼ ì´ë¦„ì—ì„œ 'ë…„/ì›”/ë°œìƒ/ê±´ìˆ˜' ê°™ì€ íŒ¨í„´ì„ ì°¾ì„ ë•Œ ì”€
from pathlib import Path                # íŒŒì¼ ê²½ë¡œë¥¼ ìš´ì˜ì²´ì œì— ìƒê´€ì—†ì´ ì•ˆì „í•˜ê²Œ ë‹¤ë£¨ê¸° ìœ„í•œ í‘œì¤€ ë¼ì´ë¸ŒëŸ¬ë¦¬

import streamlit as st                  # Streamlit: íŒŒì´ì¬ ì½”ë“œë¡œ ì›¹ ëŒ€ì‹œë³´ë“œë¥¼ ë§Œë“œëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬(UI ì¶œë ¥ ë‹´ë‹¹)
import pandas as pd                     # pandas: CSVë¥¼ í‘œ(DataFrame)ë¡œ ì½ê³  ì „ì²˜ë¦¬/ê³„ì‚°í•˜ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬
import plotly.graph_objects as go       # Plotly: ì¸í„°ë™í‹°ë¸Œ ê·¸ë˜í”„ ìƒì„±(ì—¬ê¸°ì„œëŠ” line chart)ìš©

# ====================== Streamlit ì„¤ì •(ë§¨ ìœ„!) ======================
st.set_page_config(page_title="ë³´ì´ìŠ¤í”¼ì‹± ëŒ€ì‹œë³´ë“œ", layout="wide")  # í˜ì´ì§€ ì œëª©/ë ˆì´ì•„ì›ƒ ì„¤ì •(ë°˜ë“œì‹œ st.* ì¤‘ ê°€ì¥ ë¨¼ì € ì‹¤í–‰ë˜ëŠ” ê²Œ ì•ˆì „)
st.title("ğŸ“ ë³´ì´ìŠ¤í”¼ì‹± ê³µê³µë°ì´í„° ëŒ€ì‹œë³´ë“œ (CSV ê¸°ë°˜)")               # ì•± ìƒë‹¨ íƒ€ì´í‹€ ì¶œë ¥

# ====================== ê²½ë¡œ(í•µì‹¬) ======================
# ì´ íŒŒì¼ì€ pages/ ì•ˆì— ìˆìœ¼ë¯€ë¡œ,
# __file__ ê¸°ì¤€ìœ¼ë¡œ í•œ ë‹¨ê³„ ìœ„ê°€ "ë ˆí¬ ë£¨íŠ¸"ê°€ ë¨.
ROOT = Path(__file__).resolve().parents[1]    # í˜„ì¬ íŒŒì¼(pages/ì•ˆì˜ .py)ì˜ ìƒìœ„ í´ë”(=ë ˆí¬ ë£¨íŠ¸)ë¥¼ ê³„ì‚°í•´ì„œ ì €ì¥

# CSVë¥¼ ì–´ë””ì— ë‘ë“ (ë£¨íŠ¸ or ë£¨íŠ¸/data) ë‘˜ ë‹¤ ì‹œë„í•´ë³´ëŠ” í›„ë³´ ëª©ë¡
YEARLY_CANDIDATES = [                         # ì—°ë„ë³„ CSVê°€ ìˆì„ ìˆ˜ ìˆëŠ” ìœ„ì¹˜ í›„ë³´ë“¤(ë‘˜ ì¤‘ í•˜ë‚˜ë§Œ ìˆì–´ë„ ë¨)
    ROOT / "police_voicephishing_yearly.csv",  # 1) ë ˆí¬ ë£¨íŠ¸ì— CSVê°€ ìˆëŠ” ê²½ìš°
    ROOT / "data" / "police_voicephishing_yearly.csv",  # 2) ë ˆí¬ ë£¨íŠ¸/data í´ë”ì— CSVê°€ ìˆëŠ” ê²½ìš°
]
MONTHLY_CANDIDATES = [                        # ì›”ë³„ CSVê°€ ìˆì„ ìˆ˜ ìˆëŠ” ìœ„ì¹˜ í›„ë³´ë“¤
    ROOT / "police_voicephishing_monthly.csv", # 1) ë ˆí¬ ë£¨íŠ¸ì— CSVê°€ ìˆëŠ” ê²½ìš°
    ROOT / "data" / "police_voicephishing_monthly.csv", # 2) ë ˆí¬ ë£¨íŠ¸/data í´ë”ì— CSVê°€ ìˆëŠ” ê²½ìš°
]

def pick_existing(cands: list[Path]) -> Path:  # í›„ë³´ ê²½ë¡œ ë¦¬ìŠ¤íŠ¸ë¥¼ ë°›ì•„ì„œ "ì‹¤ì œë¡œ ì¡´ì¬í•˜ëŠ” íŒŒì¼" í•˜ë‚˜ë¥¼ ê³¨ë¼ ë°˜í™˜í•˜ëŠ” í•¨ìˆ˜
    """í›„ë³´ ê²½ë¡œ ì¤‘ ì‹¤ì œ ì¡´ì¬í•˜ëŠ” íŒŒì¼ ê²½ë¡œë¥¼ í•˜ë‚˜ ê³ ë¥¸ë‹¤."""
    for p in cands:                            # í›„ë³´ë“¤ì„ í•˜ë‚˜ì”© ëŒë©´ì„œ
        if p.exists():                         # íŒŒì¼ì´ ì‹¤ì œë¡œ ìˆìœ¼ë©´(True)
            return p                           # ê·¸ íŒŒì¼ ê²½ë¡œ(Path)ë¥¼ ì¦‰ì‹œ ë°˜í™˜
    # ì–´ë””ì—ë„ ì—†ìœ¼ë©´ ì—ëŸ¬(íŒŒì¼ëª…/ìœ„ì¹˜ê°€ ë‹¤ë¥´ë‹¤ëŠ” ëœ»)
    raise FileNotFoundError(                   # í›„ë³´ë“¤ ì–´ë””ì—ë„ íŒŒì¼ì´ ì—†ìœ¼ë©´ "íŒŒì¼ ì—†ìŒ" ì˜ˆì™¸ë¥¼ ë°œìƒì‹œì¼œ ë¬¸ì œë¥¼ ë¹¨ë¦¬ ë“œëŸ¬ëƒ„
        f"íŒŒì¼ì„ ëª» ì°¾ìŒ. í›„ë³´ ê²½ë¡œ: {[str(x) for x in cands]}"  # ì–´ë–¤ ê²½ë¡œë“¤ì„ ê²€ì‚¬í–ˆëŠ”ì§€ ê°™ì´ ì¶œë ¥(ë””ë²„ê¹… ë„ì›€)
    )

yearly_path = pick_existing(YEARLY_CANDIDATES) # ì—°ë„ë³„ CSV: í›„ë³´ ì¤‘ ì‹¤ì œ ì¡´ì¬í•˜ëŠ” ê²½ë¡œë¥¼ ì„ íƒ
monthly_path = pick_existing(MONTHLY_CANDIDATES) # ì›”ë³„ CSV: í›„ë³´ ì¤‘ ì‹¤ì œ ì¡´ì¬í•˜ëŠ” ê²½ë¡œë¥¼ ì„ íƒ

# (ë””ë²„ê·¸ìš©) ì‹¤ì œë¡œ ì–´ë””ì„œ ì½ëŠ”ì§€ ë³´ì—¬ì£¼ê¸°
with st.expander("ğŸ” íŒŒì¼ ê²½ë¡œ í™•ì¸(ë¬¸ì œ ìƒê¸¸ ë•Œë§Œ ì—´ì–´ë´)"):  # ì ‘ì—ˆë‹¤ í¼ ìˆ˜ ìˆëŠ” UI(í‰ì†Œì—” ìˆ¨ê²¨ë‘ê³  í•„ìš”í•  ë•Œë§Œ í™•ì¸)
    st.write("ROOT:", str(ROOT))                  # ë ˆí¬ ë£¨íŠ¸ê°€ ì–´ë””ë¡œ ê³„ì‚°ëëŠ”ì§€ í™”ë©´ì— ì¶œë ¥
    st.write("ì—°ë„ë³„ CSV:", str(yearly_path))     # ì—°ë„ë³„ CSVì˜ ìµœì¢… ì„ íƒ ê²½ë¡œ ì¶œë ¥
    st.write("ì›”ë³„ CSV:", str(monthly_path))      # ì›”ë³„ CSVì˜ ìµœì¢… ì„ íƒ ê²½ë¡œ ì¶œë ¥


# ====================== CSV ë¶ˆëŸ¬ì˜¤ê¸°(ì¸ì½”ë”© ìë™) ======================
def read_csv_smart(path: Path) -> pd.DataFrame:   # ì¸ì½”ë”© ë¬¸ì œë¥¼ ì¤„ì´ê¸° ìœ„í•œ "ìë™ ì¸ì½”ë”© ì‹œë„" í•¨ìˆ˜
    # ê³µê³µë°ì´í„°ëŠ” utf-8-sig / cp949ê°€ ëŒ€í‘œì ì´ë¼ ì´ ìˆœì„œê°€ ì¢‹ìŒ
    for enc in ("utf-8-sig", "cp949", "euc-kr", "utf-8"):  # í”í•œ ì¸ì½”ë”© í›„ë³´ë¥¼ ìˆœì„œëŒ€ë¡œ ì‹œë„
        try:
            return pd.read_csv(path, encoding=enc) # í•´ë‹¹ ì¸ì½”ë”©ìœ¼ë¡œ CSV ì½ê¸° ì‹œë„(ì„±ê³µí•˜ë©´ ì¦‰ì‹œ ë°˜í™˜)
        except Exception:
            pass                                   # ì‹¤íŒ¨í•˜ë©´ ë‹¤ìŒ ì¸ì½”ë”© í›„ë³´ë¡œ ë„˜ì–´ê°
    # ìµœí›„: ê¹¨ì§€ëŠ” ë¬¸ì ë¬´ì‹œí•˜ê³  ì½ê¸°
    return pd.read_csv(path, encoding="utf-8", encoding_errors="ignore") # ê·¸ë˜ë„ ì•ˆ ë˜ë©´ ê¹¨ì§€ëŠ” ë¬¸ì ë¬´ì‹œí•˜ê³  ê°•ì œë¡œ ë¡œë“œ

try:
    yearly_df = read_csv_smart(yearly_path)        # ì—°ë„ë³„ CSVë¥¼ DataFrameìœ¼ë¡œ ë¡œë“œ(í‘œ í˜•íƒœ)
    monthly_df = read_csv_smart(monthly_path)      # ì›”ë³„ CSVë¥¼ DataFrameìœ¼ë¡œ ë¡œë“œ
except Exception as e:                             # ì½ê¸°ì— ì‹¤íŒ¨í•˜ë©´
    st.error(f"CSVë¥¼ ëª» ì½ì—ˆì–´: {e}")             # Streamlit í™”ë©´ì— ì—ëŸ¬ ë©”ì‹œì§€ ì¶œë ¥
    st.info("CSV ì¶œì²˜(ë‹¤ìš´ë¡œë“œ):")                 # ì‚¬ìš©ìì—ê²Œ ì°¸ê³  ì •ë³´(ì¶œì²˜) ì•ˆë‚´
    st.write("- ì—°ë„ë³„: https://www.data.go.kr/data/15063815/fileData.do") # ì—°ë„ë³„ ë°ì´í„° ë‹¤ìš´ë¡œë“œ ë§í¬
    st.write("- ì›”ë³„: https://www.data.go.kr/data/15099013/fileData.do")  # ì›”ë³„ ë°ì´í„° ë‹¤ìš´ë¡œë“œ ë§í¬
    st.stop()                                     # ì—¬ê¸°ì„œ ì•± ì‹¤í–‰ì„ ì¤‘ë‹¨(ì•„ë˜ ì½”ë“œê°€ None/ë¯¸ì •ì˜ dfë¥¼ ì“°ì§€ ì•Šê²Œ)

# ====================== ì»¬ëŸ¼ ì •ë¦¬ ======================
yearly_df.columns = yearly_df.columns.astype(str).str.strip()   # ì»¬ëŸ¼ëª… ì•ë’¤ ê³µë°± ì œê±°(ê³µê³µë°ì´í„° CSVì—ì„œ ìì£¼ ë¬¸ì œë¨)
monthly_df.columns = monthly_df.columns.astype(str).str.strip() # ì›”ë³„ ë°ì´í„°ë„ ë™ì¼í•˜ê²Œ ì»¬ëŸ¼ ê³µë°± ì œê±°

# ====================== ì‚¬ì´ë“œë°” ======================
with st.sidebar:                                # í™”ë©´ ì™¼ìª½(ë˜ëŠ” ì‚¬ì´ë“œ)ì— ì„¤ì • UIë¥¼ ëª¨ì•„ë‘ 
    st.header("ë³´ê¸°")                           # ì‚¬ì´ë“œë°” ì œëª©
    view = st.radio(                            # ë¼ë””ì˜¤ ë²„íŠ¼: ë‘ í™”ë©´ ì¤‘ í•˜ë‚˜ ì„ íƒ
        "ë¶„ì„ ì„ íƒ",
        ["ì›”ë³„ ì¶”ì´(ë°œìƒê±´ìˆ˜)", "ì—°ë„ë³„ ë¹„êµ(ìœ í˜•/í”¼í•´ì•¡/ë°œìƒ)"]
    )

# ====================== ì›”ë³„ ì¶”ì´ ======================
if view == "ì›”ë³„ ì¶”ì´(ë°œìƒê±´ìˆ˜)":                 # ì‚¬ìš©ìê°€ ì›”ë³„ ì¶”ì´ë¥¼ ì„ íƒí•œ ê²½ìš° ì‹¤í–‰ë˜ëŠ” ë¶„ê¸°
    # ì»¬ëŸ¼ ìë™ íƒìƒ‰
    year_col = next(                             # monthly_df.columns ì¤‘ì—ì„œ ì¡°ê±´ì„ ë§Œì¡±í•˜ëŠ” ì²« ì»¬ëŸ¼ëª…ì„ ì°¾ìŒ
        (c for c in monthly_df.columns if re.search(r"ì—°ë„|ë…„ë„|ë…„", c)),  # 'ì—°ë„/ë…„ë„/ë…„'ì´ ë“¤ì–´ê°„ ì»¬ëŸ¼ì„ ì—°ë„ ì»¬ëŸ¼ìœ¼ë¡œ íŒë‹¨
        None                                     # ëª» ì°¾ìœ¼ë©´ None
    )
    mon_col  = next(                             # ì›” ì»¬ëŸ¼ íƒìƒ‰
        (c for c in monthly_df.columns if re.search(r"ì›”", c)),            # 'ì›”'ì´ ë“¤ì–´ê°„ ì»¬ëŸ¼ëª… ì°¾ê¸°
        None
    )
    cnt_col  = next(                             # ë°œìƒê±´ìˆ˜ ì»¬ëŸ¼ íƒìƒ‰
        (c for c in monthly_df.columns if ("ë°œìƒ" in c and "ê±´ìˆ˜" in c)),  # 'ë°œìƒ'ê³¼ 'ê±´ìˆ˜'ê°€ ë™ì‹œì— ë“¤ì–´ê°€ë©´ ë°œìƒê±´ìˆ˜ ì»¬ëŸ¼ìœ¼ë¡œ íŒë‹¨
        None
    )

    if not (year_col and mon_col and cnt_col):   # ì…‹ ì¤‘ í•˜ë‚˜ë¼ë„ ëª» ì°¾ìœ¼ë©´(=ì»¬ëŸ¼ êµ¬ì¡°ê°€ ì˜ˆìƒê³¼ ë‹¤ë¦„)
        st.error(f"í•„ìˆ˜ ì»¬ëŸ¼ì„ ëª» ì°¾ìŒ. í˜„ì¬ ì»¬ëŸ¼: {list(monthly_df.columns)}")  # ì»¬ëŸ¼ ëª©ë¡ì„ ë³´ì—¬ì¤˜ì„œ ë¬´ì—‡ì´ ë‹¤ë¥¸ì§€ ì•Œ ìˆ˜ ìˆê²Œ
        st.stop()                                 # ë” ì§„í–‰í•˜ë©´ KeyErrorê°€ ë‚  ìˆ˜ ìˆìœ¼ë‹ˆ ì¤‘ë‹¨

    df = monthly_df.copy()                        # ì›ë³¸ monthly_dfëŠ” ìœ ì§€í•˜ê³ , ì‘ì—…ìš© ë³µì‚¬ë³¸ì„ ë§Œë“¤ì–´ ì•ˆì „í•˜ê²Œ ì²˜ë¦¬

    # ìˆ«ì ë³€í™˜(ë¬¸ì/ì‰¼í‘œ ë“± ë°©ì–´)
    df[year_col] = pd.to_numeric(                 # ì—°ë„ ì»¬ëŸ¼ì„ ìˆ«ìë¡œ ë³€í™˜
        df[year_col].astype(str).str.replace(",", "").str.strip(),         # ì‰¼í‘œ/ê³µë°± ì œê±° í›„
        errors="coerce"                           # ìˆ«ì ë³€í™˜ ì‹¤íŒ¨ ê°’ì€ NaNìœ¼ë¡œ ì²˜ë¦¬
    )
    df[mon_col]  = pd.to_numeric(                 # ì›” ì»¬ëŸ¼ ìˆ«ì ë³€í™˜
        df[mon_col].astype(str).str.replace(",", "").str.strip(),
        errors="coerce"
    )
    df[cnt_col]  = pd.to_numeric(                 # ë°œìƒê±´ìˆ˜ ìˆ«ì ë³€í™˜
        df[cnt_col].astype(str).str.replace(",", "").str.strip(),
        errors="coerce"
    )

    # ë‚ ì§œ ìƒì„± + ì •ë ¬
    df["date"] = pd.to_datetime(                  # 'YYYY-MM-01' í˜•íƒœë¡œ ë‚ ì§œë¥¼ ë§Œë“¤ì–´ ì‹œê³„ì—´ ê·¸ë˜í”„ xì¶•ìœ¼ë¡œ ì‚¬ìš©
        df[year_col].astype("Int64").astype(str) + "-" +                   # ì—°ë„(ì •ìˆ˜í˜•) â†’ ë¬¸ìì—´
        df[mon_col].astype("Int64").astype(str).str.zfill(2) + "-01",      # ì›” â†’ 2ìë¦¬(01~12)ë¡œ ë§ì¶¤ í›„ '-01' ë¶™ì„
        errors="coerce"                           # ë³€í™˜ ì‹¤íŒ¨ëŠ” NaT(ë‚ ì§œ ê²°ì¸¡)ë¡œ ì²˜ë¦¬
    )
    df = df.dropna(subset=["date"]).sort_values("date") # ë‚ ì§œê°€ ì—†ëŠ” í–‰ì€ ì œê±°í•˜ê³ (dateê°€ NaT), ì‹œê°„ìˆœìœ¼ë¡œ ì •ë ¬

    st.subheader("ğŸ“ˆ ì›”ë³„ ë°œìƒê±´ìˆ˜ ì¶”ì´")          # ì„¹ì…˜ ì œëª© ì¶œë ¥
    fig = go.Figure()                             # Plotly Figure ê°ì²´(ê·¸ë˜í”„ ìº”ë²„ìŠ¤) ìƒì„±
    fig.add_trace(go.Scatter(                     # ì„  ê·¸ë˜í”„(Scatter) ì¶”ê°€
        x=df["date"],                             # xì¶•: ë‚ ì§œ
        y=df[cnt_col],                            # yì¶•: ë°œìƒê±´ìˆ˜
        mode="lines+markers",                     # ì„  + ì (ë§ˆì»¤) í•¨ê»˜ í‘œì‹œ
        name="ë°œìƒê±´ìˆ˜"                           # ë²”ë¡€(legend) ì´ë¦„
    ))
    fig.update_layout(                            # ê·¸ë˜í”„ ë ˆì´ì•„ì›ƒ(ì¶• ì œëª©/ë†’ì´ ë“±) ì„¤ì •
        xaxis_title="ì›”",
        yaxis_title="ë°œìƒê±´ìˆ˜",
        height=450
    )
    st.plotly_chart(fig, use_container_width=True) # Streamlitì— Plotly ê·¸ë˜í”„ ì¶œë ¥(ê°€ë¡œí­ ê½‰ ì°¨ê²Œ)

    st.subheader("ğŸ“„ ì›”ë³„ ë°ì´í„°(í‘œ)")             # ë°ì´í„° í‘œ ì„¹ì…˜ ì œëª©
    st.dataframe(df, use_container_width=True)     # ì „ì²˜ë¦¬/ì •ë ¬ëœ ë°ì´í„°í”„ë ˆì„ì„ í™”ë©´ì— í‘œë¡œ ë³´ì—¬ì¤Œ

# ====================== ì—°ë„ë³„ ë¹„êµ ======================
else:                                             # ì‚¬ìš©ìê°€ ì—°ë„ë³„ ë¹„êµë¥¼ ì„ íƒí•œ ê²½ìš° ì‹¤í–‰ë˜ëŠ” ë¶„ê¸°
    # ì—°ë„ ì»¬ëŸ¼ íƒìƒ‰ ('êµ¬ë¶„'ì´ ì—°ë„ì¸ ê²½ìš°ê°€ í”í•¨)
    year_col = "êµ¬ë¶„" if "êµ¬ë¶„" in yearly_df.columns else next(  # 'êµ¬ë¶„' ì»¬ëŸ¼ì´ ìˆìœ¼ë©´ ê·¸ê±¸ ì—°ë„ ì»¬ëŸ¼ìœ¼ë¡œ ìš°ì„  ì‚¬ìš©
        (c for c in yearly_df.columns if ("ì—°ë„" in c or "ë…„ë„" in c or str(c).endswith("ë…„"))),  # ì•„ë‹ˆë©´ 'ì—°ë„/ë…„ë„/..ë…„'ìœ¼ë¡œ ëë‚˜ëŠ” ì»¬ëŸ¼ ì°¾ê¸°
        yearly_df.columns[0]                       # ê·¸ë˜ë„ ì—†ìœ¼ë©´ ì²« ì»¬ëŸ¼ì„ ì—°ë„ë¡œ ê°€ì •(ìµœí›„ì˜ ëŒ€ë¹„)
    )

    df = yearly_df.copy()                          # ì›ë³¸ yearly_df ë³´í˜¸ë¥¼ ìœ„í•´ ë³µì‚¬ë³¸ ì‚¬ìš©

    # ì—°ë„ ìˆ«ìí™” + ì •ë ¬
    df[year_col] = pd.to_numeric(                  # ì—°ë„ ì»¬ëŸ¼ì„ ìˆ«ìë¡œ ë³€í™˜(ë¬¸ì/ì‰¼í‘œ/ê³µë°± ë°©ì–´)
        df[year_col].astype(str).str.replace(",", "").str.strip(),
        errors="coerce"
    )
    df = df.dropna(subset=[year_col]).sort_values(year_col)  # ì—°ë„ ê°’ ì—†ëŠ” í–‰ ì œê±° + ì—°ë„ ì˜¤ë¦„ì°¨ìˆœ ì •ë ¬

    # ìœ í˜•ë³„ í”¼í•´ì•¡/ë°œìƒê±´ìˆ˜ ì»¬ëŸ¼ ì°¾ê¸°
    damage_cols = [c for c in df.columns if ("í”¼í•´ì•¡" in c and ("ì–µì›" in c or "ì›" in c))] # 'í”¼í•´ì•¡'ì´ í¬í•¨ë˜ê³  ë‹¨ìœ„(ì–µì›/ì›)ê°€ ìˆëŠ” ì»¬ëŸ¼ì„ í”¼í•´ì•¡ í›„ë³´ë¡œ ìˆ˜ì§‘
    case_cols   = [c for c in df.columns if ("ë°œìƒ" in c and "ê±´ìˆ˜" in c)]                 # 'ë°œìƒ'+'ê±´ìˆ˜'ê°€ ë“¤ì–´ê°„ ì»¬ëŸ¼ì„ ë°œìƒê±´ìˆ˜ í›„ë³´ë¡œ ìˆ˜ì§‘

    st.subheader("ğŸ“Š ì—°ë„ë³„ ë°ì´í„°(í‘œ)")            # ì—°ë„ë³„ ë°ì´í„° í‘œ ì„¹ì…˜ ì œëª©
    st.dataframe(df, use_container_width=True)      # ì •ë ¬ëœ ì—°ë„ë³„ ë°ì´í„°ë¥¼ í‘œë¡œ ì¶œë ¥

    if damage_cols:                                 # í”¼í•´ì•¡ ì»¬ëŸ¼ì´ í•˜ë‚˜ë¼ë„ ìˆìœ¼ë©´
        st.subheader("ğŸ“ˆ ì—°ë„ë³„ í”¼í•´ì•¡ ì¶”ì´(ìœ í˜•ë³„)") # í”¼í•´ì•¡ ê·¸ë˜í”„ ì„¹ì…˜ ì œëª©
        fig = go.Figure()                            # Plotly Figure ìƒì„±
        for c in damage_cols:                        # í”¼í•´ì•¡ ì»¬ëŸ¼(ìœ í˜•ë³„) ê°ê°ì— ëŒ€í•´
            fig.add_trace(go.Scatter(                # ì„  ê·¸ë˜í”„ í•˜ë‚˜ì”© ì¶”ê°€(ì—¬ëŸ¬ ì„  = ìœ í˜• ë¹„êµ)
                x=df[year_col],                      # xì¶•: ì—°ë„
                y=pd.to_numeric(                     # yì¶•: í•´ë‹¹ í”¼í•´ì•¡ ì»¬ëŸ¼ì˜ ìˆ«ìê°’
                    df[c].astype(str).str.replace(",", "").str.strip(),
                    errors="coerce"
                ),
                mode="lines+markers",                # ì„  + ë§ˆì»¤
                name=c                               # ë²”ë¡€ì— ì»¬ëŸ¼ëª… í‘œì‹œ(ìœ í˜• êµ¬ë¶„ìš©)
            ))
        fig.update_layout(                           # ë ˆì´ì•„ì›ƒ ì„¤ì •
            xaxis_title="ì—°ë„",
            yaxis_title="í”¼í•´ì•¡",
            height=450
        )
        st.plotly_chart(fig, use_container_width=True) # ê·¸ë˜í”„ ì¶œë ¥
    else:
        st.info("í”¼í•´ì•¡ ì»¬ëŸ¼ì„ ëª» ì°¾ì•˜ì–´(ì»¬ëŸ¼ëª…ì´ ë°”ë€Œì—ˆì„ ìˆ˜ ìˆìŒ).") # í”¼í•´ì•¡ ì»¬ëŸ¼ì´ ì—†ìœ¼ë©´ ì•ˆë‚´ ë©”ì‹œì§€ ì¶œë ¥

    if case_cols:                                    # ë°œìƒê±´ìˆ˜ ì»¬ëŸ¼ì´ ìˆìœ¼ë©´
        st.subheader("ğŸ“ˆ ì—°ë„ë³„ ë°œìƒê±´ìˆ˜ ì¶”ì´(ìœ í˜•ë³„)") # ë°œìƒê±´ìˆ˜ ê·¸ë˜í”„ ì„¹ì…˜ ì œëª©
        fig = go.Figure()                            # Plotly Figure ìƒì„±
        for c in case_cols:                          # ë°œìƒê±´ìˆ˜ ì»¬ëŸ¼(ìœ í˜•ë³„) ê°ê°ì— ëŒ€í•´
            fig.add_trace(go.Scatter(                # ì„  ê·¸ë˜í”„ ì¶”ê°€
                x=df[year_col],                      # xì¶•: ì—°ë„
                y=pd.to_numeric(                     # yì¶•: ë°œìƒê±´ìˆ˜(ìˆ«ì)
                    df[c].astype(str).str.replace(",", "").str.strip(),
                    errors="coerce"
                ),
                mode="lines+markers",                # ì„  + ë§ˆì»¤
                name=c                               # ë²”ë¡€: ì»¬ëŸ¼ëª…(ìœ í˜•ëª… ì—­í• )
            ))
        fig.update_layout(                           # ë ˆì´ì•„ì›ƒ ì„¤ì •
            xaxis_title="ì—°ë„",
            yaxis_title="ë°œìƒê±´ìˆ˜",
            height=450
        )
        st.plotly_chart(fig, use_container_width=True) # ê·¸ë˜í”„ ì¶œë ¥

st.divider()                                         # í˜ì´ì§€ êµ¬ë¶„ì„ (ì‹œê°ì ìœ¼ë¡œ êµ¬ë¶„)
st.caption("ë°ì´í„° ì¶œì²˜(ê³µì‹ CSV): ê³µê³µë°ì´í„°í¬í„¸(ê²½ì°°ì²­) ë³´ì´ìŠ¤í”¼ì‹± í˜„í™©/ì›”ë³„ í˜„í™©")  # ì¶œì²˜ ë¬¸êµ¬(ë³´ê³ ì„œ/ì•± ì‹ ë¢°ì„±ìš©)
